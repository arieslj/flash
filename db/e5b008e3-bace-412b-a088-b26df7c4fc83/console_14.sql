with t as
(
    select
        hsi.staff_info_id
        ,hsi.sys_store_id
        ,dp.on_emp_cnt
    from ph_bi.hr_staff_info hsi
    left join dwm.dwm_ph_network_wide_s dp on dp.store_id = hsi.sys_store_id and dp.stat_date = '2023-09-08'
    where
        hsi.staff_info_id in ('162111','142269','162250','154819','127556','154394','158716','163312','154811','158031','159605','136187','162206','165787','149314','154880','145278','149274','164799','163655','152639','158335','163540','161053','157797','142928','159232','122661','158006','162167','166156','161019','159142','158452','128350','156346','152683','132720','148257','154261','144316','150502','162328','149102','163291','143224','159038','143822','141563','157322','158886','144776','156563','145655','154872','159363','153485','162407','144810','160747','154768','162220','159237','128337','130753','137624','159200','164428','161745','144557','165024','155212','136832','154831','166532','125426','145528','119296','153470','133823','163489','154034','161451','164876','147595','156556','149728','156733','164372','147053','141024','158174','141431','162513','163103','123253','154579','155840','151761','139697','145445','148488','143958','155247','152741','139796','161867','140269','162702','147217','160184','163800','143637','159222','161403','132682','153417','152555','136363','153365','161741','144240','163149','152389','156832','162273','159824','153416','132322','156659','150598','152922','163478','159945','160019','162655','140194','164818','161996','163669','143515','132226','133206','159360','151491')
)
select
    t1.staff_info_id
    ,t1.sys_store_id 所属网点ID
    ,t1.on_emp_cnt 所属网点快递员数
    ,a.pi_count 揽收量
    ,a.no_return_count 正向揽收量
from t t1
left join
    (
        select
            t1.staff_info_id
            ,count(pi.pno) pi_count
            ,count(if(pi.returned = 0, pi.pno, null)) no_return_count
        from ph_staging.parcel_info pi
        join t t1 on t1.staff_info_id = pi.ticket_pickup_staff_info_id
        where
            pi.created_at >= '2023-09-07 16:00:00'
            and pi.created_at < '2023-09-08 16:00:00'
            and pi.state < 9
        group by 1
    ) a on a.staff_info_id = t1.staff_info_id


;


select
    hsi.staff_info_id
    ,dp.store_name
    ,dp.piece_name
    ,dp.region_name
from ph_bi.hr_staff_info hsi
left join  dwm.dim_ph_sys_store_rd dp on dp.store_id = hsi.sys_store_id and dp.stat_date = '2023-09-07'
where
    hsi.staff_info_id in ('143570','136488','127380','151910','122893','120156','120770','147668','164159','141652','141328','165936','161812','145180','143571','160280','164557','148940','133833','161313','156661','120611','141195','148356','166003','128792','143325','146366','165973','162934','145884','156086','128873','153606','163124','150635','142155','122788','147416','146856','138134','148747','148111','162743','165598','162519','133407','158301','156107','149787','159239','165834','158922','121928','122624','136312','138703','151162','139391','150162','151987','139480','148654','141384','119309','135218','129357','163686','165051','129003','152703','155262','125915','127043','140249','142850','120213','135239','157514','158830','158717','160793','149035','131010','149004','128031','159995','160559','155575','120323','143997','153933','128295','139295','165765','147973','121314','163778','139853','134272','164985','156634','165129','160807','136970','126451','121270','151961','154735','126897','144055','134601','146209','128306','147008','147592','120144','141102','119381','151102','136244','154612','131470','147364','141280','129468','130494','158205','130236','156307','165610','124359','155169','157685','156469','163691','165296','148727','164785','155435','147889','160428','138691','144437','141914','129483','119625','128730','162440','165962','138279','128144','131805','144949','136254','155367','136418','149547','127834','128139','152571','163528','149229','135031','127118','164712','126411','142725','128667','139185','149194','138913','147053','151436','147902','122749','126789','131076','164568','155146','142663','144438','119895','142162','136576','163929','165616','126311','165590','156466','147186','165237','146196','160814','164238','156675','157658','157855','124237','148287','137930','150181','125275','157225','162492','159332','131774','150940','128428','151797','151972','142203','146657','158994','163440','135544','151657','157060','157431','151613','161041','134123','122576','156568','126198','165785','155620','148396','127225','120658','157033','156857','141574','133888','163270','154827','160246','135787','149910','122302','146737','162424','164373','162919','161717','156367','148955','150281','163397','164570','120252','122483','122833','161562','133840','157671','152990','142685','140925','143703','123276','138360','163104','162113','163025','127931','155637','150677','132280','120914','135622','120471','157692','163108','131033','135785','123682','163169','164679','151144','122961','121364','158293','132246','158075','149374','147626','153538','164347','147958','165992','162477','145191','122855','146101','136854','143969','127910','129197','156087','136318','166308','148346','163805','121592','148847','146813','141932','130533','162679','119839','146172','165536','148797','129521','127909','121755','126685','152374','130109','150760','159753','161523','158139','162334','165576','138143','164651','120007','137809','151773','120307','131039','133430','164798','156730','146277','133728','134171','143694','128622','122404','139740','138243','163625','146215','124578','149358','164744','142592','126484','163540','145223','158995','150594','164970','127775','162977','154250','133689','121412','129363')
